user root;
worker_processes 5;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;
events {
    worker_connections 1024;
    accept_mutex off;
}


http {
    server_names_hash_bucket_size 256;
    server_names_hash_max_size 1024;
    include mime.types;
    default_type application/octet-stream;
    sendfile on;

    keepalive_timeout 65;

    server {
        if ($host = www.notuntitled.com) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        if ($host = notuntitled.com) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        listen 80 ;
        listen [::]:80 ;
        server_name notuntitled.com www.notuntitled.com;
        return 301 https://$host$request_uri;
    }

    server {
        listen 443 ssl;
        listen [::]:443 ssl;
        server_name notuntitled.com www.notuntitled.com;
        location / {
            root /var/www/public;
            index index.html index.xml;
            try_files $uri $uri/index.html $uri/index.xml $uri.html;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /var/www/public;
        }
        ssl_certificate /etc/letsencrypt/live/memorial.airmail.systems-0001/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/memorial.airmail.systems-0001/privkey.pem; # managed by Certbot
    }

    server {
        listen 443 ssl;
        listen [::]:443 ssl;
        server_name staging.notuntitled.com;
        location / {
            root /var/www/public_staging;
            index index.html index.xml;
            try_files $uri $uri/index.html $uri/index.xml $uri.html;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /var/www/public;
        }
        ssl_certificate /etc/letsencrypt/live/memorial.airmail.systems-0001/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/memorial.airmail.systems-0001/privkey.pem; # managed by Certbot
    }

    upstream phoenix {
        server 127.0.0.1:4000 max_fails=5 fail_timeout=60s;
    }

    server {
        if ($host = sophia.red) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        if ($host = mills.studio) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        if ($host = matts.gallery) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        if ($host = matt.pictures) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        listen 80;
        listen [::]:80 ;
        server_name matt.pictures matts.gallery sophia.red mills.studio;
        return 301 https://$host$request_uri;
    }
    server {
        listen 443 ssl;
        listen [::]:443 ssl;

        client_max_body_size 999M;
        server_name matt.pictures matts.gallery sophia.red mills.studio;
        location / {
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-For $remote_addr;
            #root   /var/www/public;
            #index  index.html index.xml;
            #try_files $uri $uri/index.html $uri/index.xml $uri.html;

            proxy_set_header X-Cluster-Client-Ip $remote_addr;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";

            proxy_pass http://phoenix;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /var/www/public;
        }
        ssl_certificate /etc/letsencrypt/live/memorial.airmail.systems-0001/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/memorial.airmail.systems-0001/privkey.pem; # managed by Certbot
    }


    server {
        if ($host = midnight.computer) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        listen 80 ;
        listen [::]:80 ;
        server_name midnight.computer;
        return 301 https://$server_name$request_uri;
    }

    server {
        listen 443 ssl;
        listen [::]:443 ssl;
        server_name midnight.computer;
        location / {
            root /var/www/midnight.computer;
            index index.html index.xml;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /var/www/midnight.computer;
        }
        ssl_certificate /etc/letsencrypt/live/memorial.airmail.systems-0001/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/memorial.airmail.systems-0001/privkey.pem; # managed by Certbot
    }
    server {
        listen 443 ssl;
        listen [::]:443 ssl;
        server_name ourglass.watch unnaturaldiphthongs.com www.unnaturaldiphthongs.com;
        location / {
            root /var/www/tech;
            index index.html index.xml;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /var/www/tech;
        }
        ssl_certificate /etc/letsencrypt/live/memorial.airmail.systems-0001/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/memorial.airmail.systems-0001/privkey.pem; # managed by Certbot
    }

    server {
        if ($host = www.photomattmills.com) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        if ($host = photomattmills.com) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        listen 80 ;
        listen [::]:80 ;
        server_name photomattmills.com www.photomattmills.com;
        return 301 https://$host$request_uri;
    }

    server {
        listen 443 ssl;
        listen [::]:443 ssl;
        include deny.txt;
        keepalive_timeout 5;
        server_name photomattmills.com www.photomattmills.com;
        location / {
            root /home/matt/public_html;
            index index.html index.htm;
        }

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /home/matt/public_html;
        }
        ssl_certificate /etc/letsencrypt/live/memorial.airmail.systems-0001/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/memorial.airmail.systems-0001/privkey.pem; # managed by Certbot
    }

    upstream unicorn_server {
        server unix:/tmp/unicorn.sock
        fail_timeout=0;
    }

    upstream memorial_gallery_server {
        server unix:/tmp/memorial_gallery_unicorn.sock
        fail_timeout=0;
    }


    server {
        server_name memorial.airmail.systems;
        root /home/matt/memorial_photobooth/public;
        client_max_body_size 4G;
        keepalive_timeout 5;

        location / {
            try_files $uri @app;
        }

        location @app {
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $http_host;
            proxy_redirect off;
            # pass to the upstream unicorn server mentioned above
            proxy_pass http://memorial_gallery_server;
        }

        listen 443 ssl; # managed by Certbot
        ssl_session_timeout 1440m; # managed by Certbot

        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # managed by Certbot
        ssl_prefer_server_ciphers on; # managed by Certbot

        ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256 ECDHE-ECDSA-AES256-GCM-SHA384 ECDHE-ECDSA-AES128-SHA ECDHE-ECDSA-AES256-SHA ECDHE-ECDSA-AES128-SHA256 ECDHE-ECDSA-AES256-SHA384 ECDHE-RSA-AES128-GCM-SHA256 ECDHE-RSA-AES256-GCM-SHA384 ECDHE-RSA-AES128-SHA ECDHE-RSA-AES128-SHA256 ECDHE-RSA-AES256-SHA384 DHE-RSA-AES128-GCM-SHA256 DHE-RSA-AES256-GCM-SHA384 DHE-RSA-AES128-SHA DHE-RSA-AES256-SHA DHE-RSA-AES128-SHA256 DHE-RSA-AES256-SHA256 EDH-RSA-DES-CBC3-SHA"; # managed by Certbot
        ssl_certificate /etc/letsencrypt/live/memorial.airmail.systems-0001/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/memorial.airmail.systems-0001/privkey.pem; # managed by Certbot
    }

    server {
        server_name galleries.notuntitled.com;
        server_name g.matt.pictures;
        root /home/matt/gallery/public;
        client_max_body_size 4G;
        keepalive_timeout 5;

        location / {
            try_files $uri @app;
        }

        location @app {
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $http_host;
            proxy_redirect off;
            # pass to the upstream unicorn server mentioned above
            proxy_pass http://unicorn_server;
        }

        listen 443 ssl; # managed by Certbot
        ssl_session_timeout 1440m; # managed by Certbot

        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # managed by Certbot

        ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256 ECDHE-ECDSA-AES256-GCM-SHA384 ECDHE-ECDSA-AES128-SHA ECDHE-ECDSA-AES256-SHA ECDHE-ECDSA-AES128-SHA256 ECDHE-ECDSA-AES256-SHA384 ECDHE-RSA-AES128-GCM-SHA256 ECDHE-RSA-AES256-GCM-SHA384 ECDHE-RSA-AES128-SHA ECDHE-RSA-AES128-SHA256 ECDHE-RSA-AES256-SHA384 DHE-RSA-AES128-GCM-SHA256 DHE-RSA-AES256-GCM-SHA384 DHE-RSA-AES128-SHA DHE-RSA-AES256-SHA DHE-RSA-AES128-SHA256 DHE-RSA-AES256-SHA256 EDH-RSA-DES-CBC3-SHA"; # managed by Certbot
        ssl_certificate /etc/letsencrypt/live/memorial.airmail.systems-0001/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/memorial.airmail.systems-0001/privkey.pem; # managed by Certbot
    }


    server {
        if ($host = memorial.airmail.systems) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        server_name memorial.airmail.systems;
        listen 80;
        return 404; # managed by Certbot
    }

    server {
        if ($host = galleries.notuntitled.com) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        if ($host = g.matt.pictures) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        server_name galleries.notuntitled.com;
        server_name g.matt.pictures;
        listen 80;
        return 404; # managed by Certbot
    }

    server {
        if ($host = staging.notuntitled.com) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        listen 80;
        server_name staging.notuntitled.com;
        return 404; # managed by Certbot
    }
    server {
        if ($host = www.unnaturaldiphthongs.com) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        if ($host = unnaturaldiphthongs.com) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        if ($host = ourglass.watch) {
            return 301 https://$host$request_uri;
        } # managed by Certbot


        listen 80;
        server_name ourglass.watch unnaturaldiphthongs.com www.unnaturaldiphthongs.com;
        return 404; # managed by Certbot
    }}
}
}